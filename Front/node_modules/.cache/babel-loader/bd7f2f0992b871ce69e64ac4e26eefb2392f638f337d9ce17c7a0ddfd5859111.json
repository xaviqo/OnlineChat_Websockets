{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport SockJS from \"sockjs-client\";\nimport Stomp from \"webstomp-client\";\nimport { mixins } from \"@/mixins\";\nimport { EventBus } from \"@/main\";\nimport dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport ChatUsers from \"@/components/chat/ChatUsers.vue\";\nimport ChatMessages from \"@/components/chat/ChatMessages.vue\";\nimport ChatConfiguration from \"@/components/chat/ChatConfiguration.vue\";\nimport ChatInput from \"@/components/chat/ChatInput.vue\";\nexport default {\n  mixins: [mixins],\n  components: {\n    ChatInput,\n    ChatConfiguration,\n    ChatUsers,\n    ChatMessages\n  },\n  data: () => ({\n    validConnection: true,\n    socket: null,\n    stompClient: null,\n    chatMessages: [],\n    chatUsers: [],\n    notConnectedDialog: false\n  }),\n  created() {\n    this.existsRoom();\n    if (this.isSessionSetted()) {\n      //si est치 inscrito checkear si est치 en la sala y tomar accion\n      this.isUserInscribed();\n    } else {\n      this.$router.push(\"/join/room/\" + this.$route.params.roomId);\n    }\n    EventBus.$on('chatInput_chatView_sendMessage', msg => {\n      this.sendMessage(msg);\n    });\n    dayjs.extend(relativeTime);\n    if (this.validConnection) this.connectsWS();\n  },\n  methods: {\n    connectsWS() {\n      this.socket = new SockJS('http://localhost:8080/websocket', null, {\n        sessionId: () => {\n          return this.$route.params.roomId + \":\" + this.getUserId() + \":\" + this.getNickname() + \":\" + Math.floor(Math.random() * 99999);\n        }\n      });\n      this.stompClient = Stomp.over(this.socket);\n      //this.stompClient.debug = () => { };\n      this.stompClient.connect({\n        senderId: this.getUserId(),\n        token: this.getAccessToken(),\n        senderName: this.getNickname(),\n        roomId: this.$route.params.roomId\n      }, frame => {\n        this.stompClient.subscribe(`/topic/messages/${this.$route.params.roomId}`, tick => {\n          console.log(JSON.parse(tick.body));\n        });\n      }, error => {\n        EventBus.$emit('showAlert', {\n          color: \"error\",\n          type: \"error\",\n          msg: \"Error connecting to the chat socket\"\n        });\n      });\n    },\n    sendMessage(message) {\n      //TODO: https://stomp-js.github.io/stomp-websocket/codo/class/Client.html#send-dynamic\n      // MIRAR LO DEL BODY\n      this.stompClient.send(`/ws/chat/${this.$route.params.roomId}`, JSON.stringify({\n        senderId: this.getUserId(),\n        senderName: this.getNickname(),\n        message: message\n      }), \"\");\n    },\n    existsRoom() {\n      this.axios.get(`/v1/check/room-status/${this.$route.params.roomId}`).catch(e => {\n        EventBus.$emit('showAlert', {\n          color: \"error\",\n          type: \"error\",\n          msg: `Error ${e.response.data.code}. ${e.response.data.message}`\n        });\n        this.$router.push(`/404`);\n      });\n    },\n    isUserInscribed() {\n      this.axios.get(`/v1/check/user-inscribed/${this.$route.params.roomId}`).then(res => {\n        this.validConnection = true;\n      }).catch(e => {\n        this.validConnection = false;\n        this.$router.push(\"/join/room/\" + this.$route.params.roomId);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA;EACAC;IACAC;IACAC;IACAC;IACAC;EAEA;EACAC;IACAC;IACAC;IACAC;IACAC;IACAC;IACAC;EACA;EACAC;IACA;IAEA;MACA;MACA;IACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;IACA;EACA;EACAC;IACAC;MACA;QACAC;UACA;QACA;MACA;MACA;MACA;MACA;QACAC;QACAC;QACAC;QACAC;MACA,GACAC;QACA;UACAC;QACA;MACA,GACAC;QACAX;UACAY;UACAC;UACAC;QACA;MACA;IACA;IACAC;MACA;MACA;MACA,+DACAC;QACAX;QACAE;QACAU;MACA;IACA;IACAC;MACA,WACAC,0DACAC;QACApB;UACAY;UACAC;UACAC;QACA;QACA;MACA;IACA;IACAO;MACA,WACAF,6DACAG;QACA;MACA,GACAF;QACA;QACA;MACA;IACA;EACA;AACA","names":["mixins","components","ChatInput","ChatConfiguration","ChatUsers","ChatMessages","data","validConnection","socket","stompClient","chatMessages","chatUsers","notConnectedDialog","created","EventBus","dayjs","methods","connectsWS","sessionId","senderId","token","senderName","roomId","frame","console","error","color","type","msg","sendMessage","JSON","message","existsRoom","get","catch","isUserInscribed","then"],"sourceRoot":"src/views","sources":["ChatView.vue"],"sourcesContent":["<template>\n  <div class=\"overflow-hidden\">\n    <v-row>\n      <v-col cols=\"2\">\n        <ChatUsers></ChatUsers>\n      </v-col>\n      <v-divider vertical></v-divider>\n      <v-col cols=\"8\">\n        <v-container>\n          <ChatMessages></ChatMessages>\n        </v-container>\n        <v-container>\n          <ChatInput></ChatInput>\n        </v-container>\n      </v-col>\n      <v-divider vertical></v-divider>\n      <v-col cols=\"2\">\n        <ChatConfiguration></ChatConfiguration>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n<style>\n* {\n  overflow: hidden !important;\n}\n</style>\n<script>\nimport SockJS from \"sockjs-client\";\nimport Stomp from \"webstomp-client\";\nimport { mixins } from \"@/mixins\";\nimport { EventBus } from \"@/main\";\nimport dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport ChatUsers from \"@/components/chat/ChatUsers.vue\";\nimport ChatMessages from \"@/components/chat/ChatMessages.vue\";\nimport ChatConfiguration from \"@/components/chat/ChatConfiguration.vue\";\nimport ChatInput from \"@/components/chat/ChatInput.vue\";\nexport default {\n  mixins: [mixins],\n  components: {\n    ChatInput,\n    ChatConfiguration,\n    ChatUsers,\n    ChatMessages\n\n  },\n  data: () => ({\n    validConnection: true,\n    socket: null,\n    stompClient: null,\n    chatMessages: [],\n    chatUsers: [],\n    notConnectedDialog: false,\n  }),\n  created() {\n    this.existsRoom();\n\n    if (this.isSessionSetted()){\n      //si est치 inscrito checkear si est치 en la sala y tomar accion\n      this.isUserInscribed();\n    } else {\n      this.$router.push(\"/join/room/\"+this.$route.params.roomId);\n    }\n\n    EventBus.$on('chatInput_chatView_sendMessage', msg => {\n      this.sendMessage(msg)\n    });\n\n    dayjs.extend(relativeTime);\n    if (this.validConnection) this.connectsWS();\n  },\n  methods: {\n    connectsWS(){\n      this.socket = new SockJS('http://localhost:8080/websocket', null, {\n        sessionId: () => {\n          return this.$route.params.roomId + \":\" + this.getUserId() + \":\" + this.getNickname() + \":\" + Math.floor(Math.random() * 99999);\n        }\n      });\n      this.stompClient = Stomp.over(this.socket);\n      //this.stompClient.debug = () => { };\n      this.stompClient.connect({\n            senderId: this.getUserId(),\n            token: this.getAccessToken(),\n            senderName: this.getNickname(),\n            roomId: this.$route.params.roomId,\n          },\n          frame => {\n            this.stompClient.subscribe(`/topic/messages/${this.$route.params.roomId}`, tick => {\n              console.log(JSON.parse(tick.body))\n            });\n          },\n          error => {\n            EventBus.$emit('showAlert', {\n              color: \"error\",\n              type: \"error\",\n              msg: \"Error connecting to the chat socket\"\n            });\n          });\n    },\n    sendMessage(message){\n      //TODO: https://stomp-js.github.io/stomp-websocket/codo/class/Client.html#send-dynamic\n      // MIRAR LO DEL BODY\n      this.stompClient.send(`/ws/chat/${this.$route.params.roomId}`,\n          JSON.stringify({\n            senderId: this.getUserId(),\n            senderName: this.getNickname(),\n            message: message\n          }),\"\");\n    },\n    existsRoom(){\n      this.axios\n          .get(`/v1/check/room-status/${this.$route.params.roomId}`)\n          .catch((e) => {\n            EventBus.$emit('showAlert', {\n              color: \"error\",\n              type: \"error\",\n              msg: `Error ${e.response.data.code}. ${e.response.data.message}`\n            });\n            this.$router.push(`/404`);\n          });\n    },\n    isUserInscribed(){\n      this.axios\n          .get(`/v1/check/user-inscribed/${this.$route.params.roomId}`)\n          .then((res) => {\n            this.validConnection = true;\n          })\n          .catch((e) => {\n            this.validConnection = false;\n            this.$router.push(\"/join/room/\"+this.$route.params.roomId);\n          });\n    },\n  }\n}\n</script>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}